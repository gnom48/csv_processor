# Техническое задание

## Цель разработки

Необходимо разработать **WebAPI** приложение для обработки и хранения временных метрик (`timescale`) с использованием базы данных PostgreSQL и технологии TimescaleDB. Приложение должно поддерживать три основных метода взаимодействия:

### Методы API

#### Метод №1: Обработка CSV-файлов

Первый метод принимает на вход `csv` файл следующего формата:

```
Date;ExecutionTime;Value
<Время начала ГГГГ-ММ-ДДTчч-мм-сс.ммммZ>;<Время выполнения в секундах>;<Показатель в виде числа с плавающей запятой>
```

Примеры правильных данных:

```
2023-10-01T12:00:00.000Z;1.5;42.3
2023-10-02T13:00:00.000Z;2.0;50.1
```

Перед сохранением выполняется **валидация** поступивших данных:

- Дата должна находиться в диапазоне от **01.01.2000** до текущего момента включительно.
- Время выполнения (`ExecutionTime`) не может быть отрицательным числом.
- Показатели (`Value`) также не могут быть отрицательными числами.
- Количество строк в файле должно быть от **1** до **10 000** включительно.
- Все поля обязательны и должны иметь соответствующий тип данных.

Если какое-либо условие не выполнено, нужно считать файл невалидным, откатить изменения и вернуть пользователю соответствующую ошибку.

При успешной обработке каждая запись сохраняется в таблице `Values`. Дополнительно вычисляются агрегированные показатели и сохраняются в отдельную таблицу `Results`, содержащую:

| Поле                   | Описание                                |
|------------------------|-----------------------------------------|
| FileName               | Имя файла                               |
| DeltaSeconds           | Разница во времени (секунды)            |
| StartTime              | Первая операция                         |
| AverageExecutionTime   | Среднее время выполнения                |
| AverageValue           | Средний показатель                      |
| MedianValue            | Медианное значение показателя           |
| MaxValue               | Максимальное значение показателя        |
| MinValue               | Минимальное значение показателя         |

Если файл с данным именем уже существовал ранее, старые записи удаляются перед обновлением новыми значениями.

#### Метод №2: Получение агрегаций по фильтрам

Второй метод позволяет запрашивать список записей из таблицы `Results`, используя фильтры:

- По имени файла (`FileName`)
- По диапазону дат первой операции (`StartTime`)
- По диапазону среднего показателя (`AverageValue`)
- По диапазону среднего времени выполнения (`AverageExecutionTime`)

Метод возвращает коллекцию объектов, соответствующих указанным критериям фильтра.

#### Метод №3: Получение последних 10 записей

Третий метод позволяет получать последние 10 значений показателей по указанному файлу, отсортированных по полю `Date`.

---

## Дополнительные требования

Рекомендуемые технологические стеки:

- **ASP.NET Core**: версия 8+
- **Entity Framework Core**
- **PostgreSQL + TimescaleDB**
- Документация через **Swagger**

Для улучшения качества рекомендуется покрытие кода автоматическими тестами.

## Оценочные критерии

Оцениваются:

- Качество написанного кода
- Эффективность и быстродействие методов
- Архитектурный подход и расширяемость решения

---

## Результат сдачи задания

Реализованное решение необходимо отправить ссылкой на публичный **GitHub**-репозиторий.